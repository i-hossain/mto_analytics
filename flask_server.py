from flask import Flask, url_for, request, render_template
from elasticsearch import Elasticsearch
from analytics_entry_exit import *
from basic_apis import *
from mto_genmissing import genmissing_analytics,checkAnalyticsPossible

es=Elasticsearch()

ES_HOST = {"host" : "localhost", "port" : 9200}
INDEX_NAME = 'loopdetector'
TYPE_NAME = 'mto'

es=Elasticsearch(hosts=[ES_HOST])

delta={"Hourly":3600, "Daily":86400, "Weekly":604800, "Monthly":2628000}
all_entry_exits={   "400: Exit 25 S":["400DN0080DSS","400DN0070DSS"],
                    "400: Exit 25 N":["400DN0050DNS","400DN0060DNS"],
                    "401: Exit 351":["401DW0070DWS","401DW0080DWS"],
                    "401: Exit 352":["401DW0060DWS","401DW0070DWS"],
                    "401: Exit 354":["401DW0030DWS","401DW0040DWS"],
                    "401: Exit 356":["401DW0110DEC","401DW0100DEC"],
                    "401: Exit 357":["401DW0050DWC","401DW0060DWC"],
                    "401: Exit 359 W":["401DW0030DWC","401DW0040DWC"],
                    "401: Exit 359 E":["401DW0060DEC","401DW0100DNR"],
                    "401: Exit 362":["401DW0010DEC","401DE0010DEC"],
                    "401: Exit 366":["401DE0090DWC","401DE0080DWC"],
                    "401: Exit 367":["401DE0110DWC","401DE0100DWC"],
                    "401: Exit 369":["401DE0150DWC","401DE0130DWC"],
                    "401: Exit 371 E":["401DE0150DEC","401DE0160DEC"],
                    "401: Exit 371 W":["401DE0170DWC","401DE0160DWC"],
                    "401: Exit 373":["401DE0200DWC","401DE0190DWC"],
                    "401: Exit 375":["401DE0230DWC","401DE0220DWC"],
                    "401: Exit 376":["401DE0240DEC","401DE0250DEC"],
                    "401: Exit 379 E":["401DE0280DEC","401DE0290DEC"],
                    "401: Exit 379 W":["401DE0300DWC","401DE0290DWC"],
                    "401: Exit 383":["401DE0360DWC","401DE0350DWC"],
                    "401: Exit 387":["401DE0410DWC","401DE0400DWC"],
                    "401: Exit 389":["401DE0440DEC","401DE0450DEC"],
                    "401: Exit 392":["401DE0490DWC","401DE1200DWR"],
                    "404: Exit 20":["404DN0040DSS","404DN0050DWR"]
                }

all_loopdetecors={
"16TH MILE CREEK         ":["QEWDE0251DES","QEWDE0251DWS"],
"400NB - FINCH EAST":["400DN0010DER"],
"400NB - Langstaff":["400DN0080DER"],
"400 N - Hwy 7":["400DN0050DER"],
"400 N. to Steeles":["400DN0040DER"],
"400SB - Hwy 7":["400DN0080DWR"],
"401EB - MORNINGSIDE":["401DE1030DSR"],
"401EB - PROGRESS":["401DE0820DSR"],
"401WB EXP-403WB EXP RAMP":["410DW0030DSR"],
"401WB-KINGSTON ROAD":["401DE1210DNR"],
"403-401EB EXP RAMP":["410DW0010DER"],
"403EB-QEW NB            ":["403DN0020DSR"],
"403EB-QEWSB             ":["403DN0010DER"],
"403 WB AT FREEMAN       ":["403DN0030DWF"],
"404NB - HWY 7":["404DN0090DER"],
"404NB - SHEPPARD":["404DN0010DER"],
"404NB - WOODBINE/STEELES":["404DN0060DNR"],
"404SB - FINCH":["404DN0050DWR"],
"404SB HOV TUNNEL":["401DE0530DSR"],
"404SB - HWY 7":["404DN0110DWR"],
"404 SB - STEELES":["404DN0090DWR"],
"410NB - 401EB COL":["410DW0020DNR"],
"410NB":["410DW0050DNR"],
"410SB-401EB COL RAMP":["410DW0010DSR"],
"ALLEN RD - 401WE":["401DE0210DWR"],
"ALLEN RD N OF 401":["401DE0010DSA","401DE0020DNA"],
"APPLEBY LINE            ":["QEWDE0091DWS"],
"AT BASKETWEAVE":["401DW0140DEC","401DW0230DEE"],
"AT BEACH BLVD           ":["QEWDS0080DNS"],
"AT BRANT                ":["QEWDE0010DES"],
"AT BRIMLEY":["401DE0310DWC"],
"AT BURLINGTON ST.       ":["QEWDS0100DSS"],
"AT DIXIE":["401DW0160DWC","401DW0180DEC"],
"AT EGLINTON":["410DW0030DSE","410DW0080DNR"],
"At Finch":["400DN0060DNS","400DN0070DSS"],
"AT GRAYS ROAD           ":["QEWDS0150DNS"],
"AT HWY 403/410":["401DW0210DEC"],
"AT HWY 427              ":["QEWDE0550DES"],
"At Hwy 7":["400DN0020DNC","400DN0020DSE","400DN0030DSC"],
"AT KEELE":["401DE0010DEC"],
"AT KENNEDY":["401DE0280DWC","401DE0290DWC"],
"At Langstaff":["400DN0050DSE","400DN0120DNS"],
"AT MARKHAM":["401DE0350DEC","401DE0360DEE"],
"AT MATHESON":["410DW0010DSE","410DW0020DNE"],
"AT McCOWAN":["401DE0330DEE"],
"AT MCNICOLL":["404DN0040DNS"],
"AT MEADOWVALE":["401DE0190DET","401DE0450DEC","401DE0470DEE"],
"AT MIDLAND":["401DE0300DWC"],
"AT MILLEN ROAD          ":["QEWDS0160DSS"],
"AT MORNINGSIDE":["401DE0420DEC","401DE0430DEE"],
"AT NEILSON":["401DE0160DWT","401DE0370DWE","401DE0380DEC","401DE0390DEE"],
"AT PED. OVERPASS        ":["QEWDE0510DWS"],
"AT PLAINS RD.           ":["QEWDN0030DSS"],
"AT QEW or 403 SPLIT        ":["QEWDE0310DES"],
"AT RENFORTH":["401DW0200DEE"],
"At Sheppard":["400DN0030DNS","404DN0010DNE"],
"AT TOMKEN":["401DW0200DEC","401DW0290DEE"],
"AT TRANSFER":["401DW0120DWC","401DW0220DWE"],
"AT WINSTON CHURCHILL    ":["QEWDE0350DWS"],
"AT YONGE":["401DE0130DEC"],
"BEACH BLVD - QEW NB     ":["QEWDS0030DNR"],
"BRIMLEY NB - 401 WB":["401DE0840DWR"],
"BROCK":["401DE0260DWT","401DE0570DWE"],
"BROCK ROAD":["401DE0590DEC","401DE0610DEE"],
"BURLINGTON - QEW NB     ":["QEWDS0040DNR"],
"BURLOAK DRIVE           ":["QEWDE0121DES"],
"BURL ST - RED HILL EXPWY":["QEWDS0065DWR"],
"CAWTHRA SB - QEW WB     ":["QEWDE0280DWR"],
"CN RAIL":["401DE0530DWC","401DE0530DWE","401DE0560DEC","401DE0580DEE"],
"COLLINS":["401DE0410DWC"],
"E 401 - DVP S":["401DE0580DSR","401DE0590DSR"],
"E 401 - Hwy 404 N":["401DE0570DNR"],
"E 401 - Leslie S":["401DE0480DSR"],
"E 401 - YONGE ST.":["401DE0400DNR"],
"EAST OF 3RD LINE        ":["QEWDE0201DES","QEWDE0201DWS"],
"EAST OF APPLEBY         ":["QEWDE0101DES","QEWDE0111DES","QEWDE0111DWS"],
"EAST OF BRONTE          ":["QEWDE0181DWS"],
"EAST OF BURLOAK         ":["QEWDE0131DWS","QEWDE0141DWS","QEWDE0151DWS"],
"EAST OF DORVAL          ":["QEWDE0241DES"],
"EAST OF GUELPH LINE     ":["QEWDE0041DES","QEWDE0041DWS","QEWDE0051DES","QEWDE0051DWS"],
"EAST OF TRAFALGAR       ":["QEWDE0280DES"],
"EAST OF WALKERS         ":["QEWDE0071DES","QEWDE0071DWS","QEWDE0081DES","QEWDE0081DWS"],
"EB 401-BROCK":["401DE1330DSR"],
"EB401 EXP/COL-404 EXP":["401DE0575DNR"],
"EB401 EXP-NB404 EXP":["401DE0560DNR"],
"EB401-KINGSTON ROAD":["401DE1150DSR"],
"EB401-WHITES":["401DE1230DSR"],
"EB HWY2A-401EB":["401DE1170DER"],
"E. EGLINTON - HWY 401 W.":["401DW0390DWR"],
"E. EGLINTON - HWY 427 N.":["401DW0040DNR"],
"E. HWY 401- CARLINGVIEW":["401DW0350DNR"],
"E. HWY 401- HWY 427 S.":["401DW0340DSR"],
"E OF 400":["401DW0030DEE","401DW0040DEC","401DW0040DEE","401DW0040DWC"],
"E OF ALLEN RD":["401DE0060DEE"],
"E OF ALLEN ROAD":["401DE0070DEC","401DE0070DEE"],
"E. OF APPLEBY LINE      ":["QEWDE0110DES"],
"E OF AVENUE RD":["401DE0030DET"],
"E OF AVENUE ROAD":["401DE0110DEC","401DE0110DEE"],
"E OF BASKET WEAVE":["401DW0010DWC","401DW0010DWE"],
"E of Bayview":["401DE0050DET","401DE0160DWC","401DE0170DEC","401DE0170DEE","401DE0180DEC","401DE0180DEE","401DE0190DEC","401DE0190DEE"],
"E. OF BIRCHMOUNT":["401DE0280DEC"],
"E OF BIRCHMOUNT":["401DE0280DEE"],
"E. OF BRIMLEY":["401DE0320DEC","401DE0320DEE"],
"E. OF BRONTE            ":["QEWDE0180DES"],
"E. OF COLLINS":["401DE0430DEC","401DE0450DEE"],
"E. OF CREDIT RIVER      ":["QEWDE0450DWS"],
"E. OF DIXIE":["401DW0160DEC","401DW0170DEC","401DW0260DEE"],
"E of Don Mills":["401DE0220DEC","401DE0220DEE"],
"E OF DUFFERIN":["401DE0030DWC"],
"E OF DVP":["401DE0655DER"],
"E. OF ETOBICOKE CREEK":["401DW0130DEC","401DW0130DWC","401DW0220DEE","401DW0230DWE"],
"E OF HWY27":["401DW0050DES"],
"E OF HWY 27":["401DW0060DWS"],
"E of Hwy 404/DVP":["401DE0230DEC","401DE0230DEE"],
"E OF ISLINGTON":["401DW0080DWC","401DW0090DEE"],
"E OF JANE":["401DW0010DWT","401DW0020DEC"],
"E OF KEELE":["401DE0020DWC","401DE0030DWE"],
"E. OF KENNEDY":["401DE0300DEC"],
"E. OF LIVERPOOL":["401DE0580DEC","401DE0600DEE"],
"E. OF MARKHAM":["401DE0150DET","401DE0370DEC","401DE0370DEE","401DE0380DEE"],
"E OF MARTINGROVE":["401DW0020DES","401DW0030DES","401DW0040DWS"],
"E. OF MCCOWAN":["401DE0330DEC","401DE0340DEC","401DE0340DEE","401DE0350DEE"],
"E. OF MEADOWVALE":["401DE0460DEC","401DE0480DEE"],
"E. OF MIDLAND":["401DE0310DEE"],
"E. OF MORNINGSIDE":["401DE0390DWC","401DE0390DWE"],
"E. OF NEILSON":["401DE0390DEC","401DE0400DEC","401DE0410DEC","401DE0410DEE","401DE0420DEE"],
"E. OF PORT UNION":["401DE0210DET","401DE0220DWT","401DE0470DWC","401DE0470DWE","401DE0500DEC","401DE0520DEE"],
"E. OF QEW or 403 SPLIT     ":["QEWDE0320DES"],
"E OF RENFORTH":["401DW0100DWS"],
"E OF RENFORTH DR":["401DW0080DES"],
"E. OF ROYAL WINDSOR     ":["QEWDE0300DWS"],
"E. OF SOUTHDOWN         ":["QEWDE0400DES","QEWDE0400DWS"],
"E. OF THIRD LINE        ":["QEWDE0200DWS"],
"E. OF TOMKEN":["401DW0190DEC","401DW0280DEE"],
"E of Victoria Park":["401DE0260DEC"],
"E. OF WALKERS           ":["QEWDE0070DWS"],
"E OF WARDEN":["401DE0090DET"],
"E OF WESTON":["401DW0060DEC","401DW0060DWC"],
"E. OF WHITES":["401DE0240DET","401DE0520DWC","401DE0520DWE","401DE0540DEC","401DE0550DEC","401DE0560DEE","401DE0570DEE"],
"E OF YONGE":["401DE0130DWC"],
"ERIN MILLS SB - QEW WB  ":["QEWDE0225DWR"],
"FAIRVIEW EB - QEW SB    ":["QEWDN0040DNR"],
"FAIRVIEW WB - QEW SB    ":["QEWDN0050DNR"],
"FINCH - 404 SB":["404DN0040DSR"],
"Finch E. - 400 S.":["400DN0010DSR"],
"FINCH EAST - 400 N":["400DN0020DNR"],
"FINCH W - 400 N":["400DN0030DNR"],
"Finch W. - 400s.":["400DN0020DSR"],
"FINCH WEST - 404 NB":["404DN0050DNR"],
"FORD NB - QEW WB        ":["QEWDE0205DWR"],
"FOURTH LINE             ":["QEWDE0221DES"],
"FROM WEST MALL          ":["QEWDE0500DWR"],
"GUELPH LINE             ":["QEWDE0030DES"],
"GUELPH LINE TO QEW WEST ":["QEWDE0060DWR"],
"HOV AT 407TER":["404DN0081DNH"],
"HOV AT JOHN":["404DN0081DSH"],
"HOV AT MCNICOLL":["404DN0041DNH","404DN0041DSH"],
"HOV AT STEELE":["404DN0071DSH"],
"HOV AT STEELES":["404DN0051DNH"],
"HOV AT VANHORNE":["404DN0011DNH"],
"HOV AT VAN HORNE":["404DN0011DSH"],
"HOV NORTH OF 407ETR":["404DN0091DNH","404DN0101DNH"],
"HOV NORTH OF JOHN":["404DN0071DNH"],
"HOV NORTH OF STEELES":["404DN0061DNH"],
"HOV SOUTH OF 407ETR":["404DN0091DSH"],
"HOV SOUTH OF STEELES":["404DN0061DSH"],
"HOV SOUTH OF WOODBINE":["404DN0051DSH"],
"HWY 10 SB - QEW WB      ":["QEWDE0260DWR"],
"HWY2-401WB":["401DE1280DWR"],
"HWY27 S. S.0F 401":["401DW0410DSR"],
"HWY 2 EB - QEW NB       ":["QEWDN0020DNR"],
"HWY 2 WB - QEW NB       ":["QEWDN0010DNR"],
"HWY 403 SB - QEW WB     ":["QEWDE0400DWR"],
"Hwy 404 N of 401":["401DE0030DSF","401DE0040DNF"],
"HWY 427 NB":["401DW0040DNF","401DW0060DNF"],
"HWY 427 N. N.0F 401":["401DW0080DNF"],
"Hwy 7 - 400NB":["400DN0060DNR"],
"HWY 7 - 404 NB":["404DN0100DNR","404DN0110DNR"],
"Hwy 7 W. - 400S.":["400DN0070DSR"],
"Hwy 7 West - 400 NB":["400DN0070DNR"],
"Hwy E. - 400 S.":["400DN0060DSR"],
"KENNEDY SB - 401 EB":["401DE0780DER"],
"KENNEDY SB - 401 WB":["401DE0760DWR"],
"KINGSTON ROAD":["401DE0470DEC","401DE0480DEC","401DE0490DEE","401DE0500DEE"],
"KINGSTON-WB 401":["401DE1160DWR"],
"Langstaff E.- 400 S.":["400DN0090DSR"],
"Langstaff W - 400 S.":["400DN0100DSR"],
"LIVERPOOL":["401DE0550DWC","401DE0550DWE"],
"LIVERPOOL ROAD":["401DE0570DEC"],
"MARKHAM NB - 401 EB":["401DE0960DER"],
"MARKHAM NB - 401 WB":["401DE0950DWR"],
"MARKHAM SB - 401 WB":["401DE0930DWR"],
"MCCOWAN SB - 401 EB":["401DE0860DER"],
"MCCOWAN SB - 401 WB":["401DE0870DWR"],
"MORININGSIDE SB - 401 WB":["401DE1040DWR"],
"N ALLEN - YORKDALE":["401DE0160DSR"],
"n Bayview - 401 e":["401DE0460DER"],
"N Bayview - 401 w":["401DE0440DWR"],
"NB BURLOAK-WB QEW       ":["QEWDE0120DWR"],
"NB ERIN MILLS-WB QEW    ":["QEWDE0230DWR"],
"NB LIVERPOOL-401WB":["401DE1310DWR"],
"NB MORNINGSIDE-401WB":["401DE1070DWR"],
"NB WHITES-401WB":["401DE1260DWR"],
"NB WHITES - EB 401":["401DE1270DER"],
"N. CARLINGVIEW-HWY 401 E":["401DW0360DER"],
"NEAR ETOBICOKE CREEK":["401DW0240DEE"],
"NEAR HWY 27":["401DW0060DES"],
"NEAR LAKE AVE           ":["QEWDS0140DSS"],
"NEAR MEADOWVALE":["401DE0200DWT","401DE0430DWC"],
"NEAR MORNINGSIDE":["401DE0180DWT","401DE0400DWC","401DE0400DWE"],
"N-E DIXIE RAMP":["401DW0461DER"],
"NEILSON - 401 EB":["401DE1010DER"],
"NEILSON NB - 401 WB":["401DE1000DWR"],
"N Hwy 404 - 401 e":["401DE0650DER"],
"N Hwy 404 - 401 W":["401DE0600DWR"],
"N. HWY 427-EGLINTON E.":["401DW0050DER"],
"N Leslie - 401 E":["401DE0510DER"],
"N Leslie - 401 W":["401DE0500DWR"],
"N.of 407":["400DN0010DSE"],
"N OF EGLINTON":["410DW0030DNE"],
"N. of Finch":["400DN0080DSS"],
"N. of Hwy 7":["400DN0030DSE"],
"North of 407":["400DN0010DNC"],
"NORTH OF 407ETR":["404DN0090DNS"],
"North of Hwy 401":["400DN0010DNS"],
"North of Hwy 7":["400DN0040DNC","404DN0110DNS"],
"North of Steeles":["400DN0100DNS"],
"North of Steeles/CN Rail":["400DN0110DNS"],
"N Victoria Park - 401 w":["401DE0690DWR"],
"N Warden - 401 E":["401DE0750DER"],
"N-W DIXIE RAMP":["401DW0440DWR"],
"PORT UNION":["401DE0460DWC","401DE0460DWE","401DE0490DEC","401DE0510DEE"],
"PORT UNION - 401 EB":["401DE1220DER"],
"PORT UNION - 401 WB":["401DE1190DWR"],
"QEW NB - 403 WB         ":["QEWDN0070DNR"],
"QEW NORTH OF CMS 4      ":["QEWDS0050DNS"],
"QEW SB AT FREEMAN       ":["QEWDN0040DSS"],
"QEW SB - WOODWARD       ":["QEWDS0030DWR"],
"RAMP 401E - 400S":["401DW0040DSR"],
"RAMP 401EC - AVENUE S":["401DE0310DSR"],
"RAMP E401 - 409W":["401DW0210DSR","401DW0220DSR"],
"RAMP E 401 - ALLEN":["401DE0180DNR"],
"RAMP E 401 - ALLEN S":["401DE0200DSR"],
"RAMP E 401 - BATHURST":["401DE0280DNR"],
"RAMP E401 - DIXON RD":["401DW0280DNR"],
"RAMP E 401 - ISLINGTON":["401DW0200DSR"],
"RAMP E 401WE - 409W":["401DW0180DWR"],
"RAMP E401 - WESTON":["401DW0110DNR"],
"RAMP E.EGLINTON-HWY27 S.":["401DW0400DSR"],
"RAMP N 400 - 401EC":["401DW0020DER"],
"RAMP N.427-EGLINTON E.":["401DW0090DER"],
"RAMP N ALLEN - 401WC":["401DE0120DWR"],
"RAMP N AVENUE - 401E":["401DE0320DER"],
"RAMP N AVENUE - 401W":["401DE0300DWR"],
"RAMP N DIXON RD - 401":["401DW0300DER"],
"RAMP N WESTON - 401EC":["401DW0140DER"],
"RAMP S 400 - 401EC":["401DW0010DER"],
"RAMP S ALLEN - 401":["401DE0230DER"],
"RAMP S ALLEN - 401WC":["401DE0110DWR"],
"RAMP S AVENUE - 401E":["401DE0340DER"],
"RAMP S AVENUE - 401W":["401DE0330DWR"],
"RAMP S DIXON RD - 401":["401DW0270DER"],
"RAMP S DUFFERIN 401WC":["401DE0080DWR"],
"RAMP S DUFFERIN - 401WC":["401DE0090DWR"],
"RAMP S KEELE - 401WC":["401DE0040DWR"],
"RAMP S YONGE - 401W":["401DE0380DWR"],
"RAMP TO DIXIE":["401DW0471DER"],
"RAMP W401 - 400N":["401DW0100DNR"],
"RAMP W401 - DIXON RD":["401DW0310DSR"],
"RAMP W401 - DUFFERIN S":["401DE0070DSR"],
"RAMP W401 - KEELE S":["401DE0020DSR"],
"RAMP W.401-RENFORTH AVE.":["401DW0440DER"],
"RAMP YORKDALE - 401":["401DE0240DER"],
"RAMP YORKDALE - ALLEN":["401DE0170DNR"],
"RHCE/HWY20 - QEW SB     ":["QEWDS0080DSR"],
"ROUGEMOUNT":["401DE0490DWC","401DE0490DWE"],
"ROUGE RIVER":["401DE0480DWE"],
"ROUGHMOUNT":["401DE0520DEC"],
"ROYAL WINDSOR NB-QEW WB ":["QEWDE0190DWR"],
"ROYAL WINSOR DRIVE      ":["QEWDE0290DWS"],
"SB410COL - CAWTHRA":["410DW0110DSR"],
"S Bayview - 401 e":["401DE0430DER"],
"SB BROCK - 401WB":["401DE1340DWR"],
"SB COLL. TO QEW SB      ":["QEWDS0010DSR"],
"SB DORVAL - EB QEW      ":["QEWDE0150DER"],
"SB DORVAL - WB QEW      ":["QEWDE0150DWR"],
"SB GUELPH-EB QEW        ":["QEWDE0050DER"],
"SB LIVERPOOL-401WB":["401DE1300DWR"],
"SB MEADOWVALE-401WB":["401DE1090DWR"],
"SB PORT UNION-401EB":["401DE1180DER"],
"SB QEW - CENTENNIAL PKWY":["QEWDS0070DSR"],
"SB QEW - RHCE           ":["QEWDS0045DSR"],
"SB TRAFALGAR - WB QEW   ":["QEWDE0170DWR"],
"SB WALKERS-EB QEW       ":["QEWDE0070DER"],
"SB WALKERS-WB QEW       ":["QEWDE0070DWR"],
"SB WHITES-401WB":["401DE1240DWR"],
"SB WHITES-EB 401":["401DE1250DER"],
"S DIXON RD - 401":["401DW0290DWR"],
"S DVP - 401 E":["401DE0550DER"],
"S DVP - 401 W":["401DE0530DWR","401DE0539DWR","401DE0540DWR","401DE0541DWR"],
"S-E DIXIE RAMP":["401DW0451DER"],
"SERV ROAD - SB QEW      ":["QEWDS0020DSR"],
"SHEPPARD - 404 SB":["404DN0010DSR"],
"SHEPPART - 404 NB":["404DN0020DNR"],
"S. HWY 427 - HWY 401 E.":["401DW0340DER"],
"S. HWY 427 - HWY 401 W.":["401DW0360DWR"],
"S Leslie - 401 E":["401DE0490DER"],
"S Leslie - 401 W":["401DE0470DWR"],
"S OF 401":["410DW0010DSC"],
"S. of 401 Exit":["400DN0005DSS"],
"S. of 407":["400DN0120DSS"],
"S. OF BRANT             ":["QEWDN0060DNS","QEWDN0060DSS"],
"S. OF CENTENNIAL PKWY   ":["QEWDS0130DSS"],
"S. OF EGLINTON":["410DW1040DNS"],
"S. OF FAIRVIEW          ":["QEWDN0020DSS"],
"S. of Finch":["400DN0060DSS"],
"S. OF HWY 2             ":["QEWDS0010DNS"],
"S. of Langstaff":["400DN0040DSE","400DN0050DSC"],
"S OF MATHESON":["410DW0020DSC"],
"S. of Sheppard":["400DN0020DSS"],
"S. of Steeles":["400DN0090DSS","400DN0100DSS"],
"South of 407":["400DN0080DNS"],
"SOUTH OF CENTENNIAL     ":["QEWDS0130DNS"],
"SOUTH OF FINCH":["400DN0061DSS"],
"South of Langstaff":["400DN0050DNC"],
"SOUTH OF STEELES":["404DN0060DSS"],
"SOUTH OF WOODBINE":["404DN0050DSS"],
"Steeles - 400 S.":["400DN0040DSR"],
"STEELES - 404 NB":["404DN0070DNR","404DN0080DNR"],
"STEELES - 404 SB":["404DN0080DSR"],
"S Victoria Park - 401 E":["401DE0680DER"],
"S-W DIXIE RAMP":["401DW0450DWR"],
"THIRD LINE-EB QEW       ":["QEWDE0140DER"],
"THIRD LINE              ":["QEWDE0191DWS"],
"THIRD LINE - QEW        ":["QEWDE0135DER"],
"THIRD LINE-WB QEW       ":["QEWDE0140DWR"],
"TO DIXIE                ":["QEWDE0490DWR"],
"TO EGLINTON":["401DW0380DER"],
"TO HWY 10 SOUTH         ":["QEWDE0450DSR"],
"TO HWY 427              ":["QEWDE0510DNR"],
"TO WCB                  ":["QEWDE0420DSR"],
"TRAFALGAR               ":["QEWDE0260DWS","QEWDE0261DES","QEWDE0261DWS"],
"TRANSFER(EXP TO COL)":["401DW0030DWT"],
"W00DBINE - 404 SB":["404DN0060DSR"],
"w 401 - Bayview N":["401DE0450DNR"],
"W 401 - DVP s":["401DE0630DSR","401DE0640DSR"],
"W 401 - Hwy 404 N":["401DE0610DNR","401DE0620DNR"],
"W 401 - Leslie N/S":["401DE0520DNR"],
"WALKERS LINE            ":["QEWDE0061DES"],
"WARDEN SB - 401 WB":["401DE0720DWR"],
"WB401EXP - SB410EXP":["410DW0070DSR"],
"WB401-HWY 2":["401DE1290DNR"],
"WB401-LIVERPOOL":["401DE1320DNR"],
"WB QEW- BRONTE          ":["QEWDE0360DNR"],
"WB QEW - CAWTHRA        ":["QEWDE0480DNR"],
"WB QEW - DORVAL         ":["QEWDE0390DNR"],
"WB QEW-GUELPH LINE      ":["QEWDE0310DNR"],
"WB QEW-WALKERS LINE     ":["QEWDE0320DNR"],
"WCB NB - QEW WB         ":["QEWDE0220DWR"],
"WCB SB - QEW WB         ":["QEWDE0210DWR"],
"WEST OF FORD DRIVE      ":["QEWDE0310DWS"],
"WEST OF ROYAL WINDSOR   ":["QEWDE0280DWS"],
"WHITES":["401DE0510DWC","401DE0510DWE"],
"WHITES ROAD":["401DE0530DEC","401DE0550DEE"],
"W. HWY 401-HWY 427 N.":["401DW0430DNR"],
"W OF 400":["401DW0050DEC","401DW0050DEE","401DW0090DSR"],
"W of 404/DVP":["401DE0190DWE"],
"W OF ALLEN":["401DE0010DWT"],
"W OF ALLEN ROAD":["401DE0060DEC"],
"W OF AVENUE ROAD":["401DE0100DEC","401DE0100DEE"],
"W OF BATHURST":["401DE0080DEC"],
"W of Bayview":["401DE0150DWC","401DE0160DEC"],
"W. OF BROCK":["401DE0560DWC","401DE0560DWE"],
"W. OF BRONTE            ":["QEWDE0140DWS"],
"W. OF DIXIE":["401DW0170DWC","401DW0270DWE"],
"W OF DUFFERIN":["401DE0040DEE","401DE0040DWC","401DE0050DEC"],
"W. OF ETOBICOKE CREEK":["401DW0150DWC"],
"W OF HWY 27":["401DW0080DWS"],
"W of Hwy 404/DVP":["401DE0080DWT","401DE0190DWC","401DE0200DWE","401DE0210DWE"],
"W OF KEELE":["401DE0010DEE","401DW0010DEC"],
"W. OF KENNEDY":["401DE0290DEC","401DE0290DEE"],
"W OF KIPLING":["401DW0020DWS","401DW0030DWS"],
"W of Leslie":["401DE0180DWC"],
"W. OF MARKHAM":["401DE0330DWC","401DE0330DWE"],
"W. OF MEADOWVALE":["401DE0420DWC","401DE0420DWE","401DE0440DEC"],
"W. OF MISSISSAUGA RD":["QEWDE0410DES","QEWDE0420DES"],
"W. OF NEILSON":["401DE0360DWC","401DE0360DWE"],
"W. OF RENFORTH":["401DW0110DWC","401DW0120DEC","401DW0200DWE","401DW0210DEE"],
"W. OF ROUGHMOUNT":["401DE0510DE","401DE0510DEC"],
"W. OF SOUTHDOWN         ":["QEWDE0360DES","QEWDE0360DWS"],
"W. OF THIRD LINE        ":["QEWDE0180DWS","QEWDE0190DWS"],
"W of Victoria Park":["401DE0220DWC","401DE0230DWC"],
"W of Warden":["401DE0240DWC","401DE0260DWC","401DE0260DWE"],
"W. OF WCB               ":["QEWDE0340DWS"],
"W OF WESTON":["401DW0070DEC","401DW0070DEE","401DW0080DEC"],
"W. OF WHITES":["401DE0500DWC","401DE0500DWE"]        
}

app = Flask(__name__)

@app.route('/')
def default():
	return render_template('index.html')

# /api/0.1/loop_detector/mto
@app.route('/api/0.1/loop_detector/mto')
def api_basic():
    print "Requested url : ", request.url
    print len(request.args)
    

    time1 = request.args['time1']
    #print "time1 = ",time1
    
    if len(request.args)<2:
        result = apis(time1=time1)

    else:
        time2 = request.args['time2']
        result = apis(time1=time1,time2=time2)
 
    print result
    return result


@app.route('/entry_exit')
def entry_exit_analytic():
    #print "Requested url : ", request.url
    name = all_entry_exits[request.args['name']];
    frequency = delta[request.args['frequency']];
    time1 = int(request.args['time1']);
    time2 = int(request.args['time2']);
    #print "frequency : ", frequency
    #print name
    print "Requested url : ", request.url
    result = entry_exit_analytics(time1, time2, name, frequency)
    
    print "!!!!!!!!!!!new test!!!!!!!!!!!!"
    print result
    
    return result

#TODO implement graceful error handling
#TODO implement max and min timestamps to make input more user friendly
@app.route('/genmissing')
def genmissing_analytic():
    contractID=request.args['name'];
    contractID=contractID.split(':');
    contractID=contractID[1];
    #frequency = delta[request.args['frequency']];
    time1 = int(request.args['time1']);
    time2 = int(request.args['time2']);
    print "time1 = ", time1, " time2 = ", time2, "contractID = ", contractID
    possible = checkAnalyticsPossible(time1, time2, contractID, 'loopdetector');
    print "analytics possible = ", possible;
    if(possible!=0):
        if(possible==1):
                result = json.dumps({'error': "1", 'message':"input time duration too long" })
        elif(possible==4):
                result = json.dumps({'error': "4", 'message':"Start time is later than or the same as end time" })
        else:
                result = json.dumps({'error': "-1", 'message':"no records available for this time period" })
        print result
        return result
    result = genmissing_analytics(time1, time2, contractID, 'loopdetector', 20);
    return result;


if __name__ == '__main__':
	port = 80;

	if port == 80:
		app.debug = True

	app.run(host='0.0.0.0', port=port)
